/*! jquery.CV - v0.0.1 - 2013-06-17
* Copyright (c) 2013 Damon Zucconi; Licensed MIT */!function(){jQuery(function(){var a;return a=function(){function a(a){this.key=a}return a.prototype.fetch=function(){var b=this;return $.ajax({url:"https://spreadsheets.google.com/pub?key="+this.key+"&hl=en&output=csv",method:"get"}).done(function(c){var d;return d=$.csv.toObjects(c),b.rows=$.map(d,function(b){return new a.Row(b)}),b.categories=_.chain(b.rows).groupBy("type").map(function(b){return new a.Category(b)}).value()})},a}(),a.Row=function(){function a(a){var b,c;for(b in a)c=a[b],this[b.toLowerCase()]=c.trim()}return a}(),a.Category=function(){function b(b){this.name=b[0].category,this.years=_.chain(b).groupBy("year").map(function(b){return new a.Category.Year(b)}).value().reverse()}return b}(),a.Category.Year=function(){function a(a){this.name=a[0].year,this.entries=a}return a}(),$.CV=function(b,c){var d=this;return this.$el=$(b),this.init=function(){var b;if(d.settings=$.extend({},d.defaults,c),void 0===d.settings.key)throw"Missing key";return b=new a(d.settings.key),d.$el.html("Loading"),$.when(b.fetch()).then(function(){var a;return a=_.map(b.categories,function(a){return d.settings.templates.category({category:a})}),d.$el.html(a)})},this.init()},$.CV.prototype.defaults={templates:{category:_.template('<div class="category">\n  <h3><%= category.name %></h3>\n\n  <% _.each(category.years, function(year) { %>\n    <div class="year">\n      <h4><%= year.name %></h4>\n\n      <% _.each(year.entries, function(entry) { %>\n        <%= $.CV.prototype.defaults.templates.entry({ entry: entry }) %>\n      <% }) %>\n    </div>\n  <% }); %>\n</div>'),entry:_.template('<div class="entry">\n  <% if (entry.url) { %>\n    <a href="<%= entry.url %>" target="_blank"><%= entry.title %></a>,\n  <% } else { %>\n    <u><%= entry.title %></u>,\n  <% } %>\n\n  <%= entry.venue %>\n\n  <% if (entry.city && entry.country) { %>\n    (<%= entry.city %>, <%= entry.country %>)\n  <% } %>\n\n  <% if (entry.notes) { %>\n    - <%= entry.notes %>\n  <% } %>\n</div>')}},$.fn.CV=function(a){return this.each(function(){var b;return void 0===$(this).data("CV")?(b=new $.CV(this,a),$(this).data("CV",b)):void 0})}})}.call(this);